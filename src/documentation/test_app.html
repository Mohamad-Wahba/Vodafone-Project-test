<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>test_app API documentation</title>
<meta name="description" content="Vodafone Chatbot Application Tests â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>test_app</code></h1>
</header>
<section id="section-intro">
<p>Vodafone Chatbot Application Tests</p>
<p>This module contains unit tests for the Vodafone Chatbot Application.
It tests the main components and functions of the app.py module.</p>
<p>The tests cover database initialization, SQL chain generation,
response generation, and Streamlit component interactions.</p>
<p><strong>Authors:</strong> Mohamed Bassiony, Mohamad Wahba, Beshoy Ashraf Samir, Mohamad Sharqawi
<strong>Date:</strong> July 14, 2024</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Vodafone Chatbot Application Tests

This module contains unit tests for the Vodafone Chatbot Application.
It tests the main components and functions of the app.py module.

The tests cover database initialization, SQL chain generation,
response generation, and Streamlit component interactions.

**Authors:** Mohamed Bassiony, Mohamad Wahba, Beshoy Ashraf Samir, Mohamad Sharqawi
**Date:** July 14, 2024
&#34;&#34;&#34;

from unittest.mock import Mock, patch

import pytest

from app import get_response, get_sql_chain, init_database


@pytest.fixture
def mock_db():
    &#34;&#34;&#34;
    Fixture to create a mock database object for testing.

    Returns:
        Mock: A mock object representing the database.
    &#34;&#34;&#34;
    return Mock()


def test_init_database():
    &#34;&#34;&#34;
    Test the initialization of the database connection.

    This test ensures that the init_database function correctly
    initializes a SQLDatabase object with the given parameters.
    &#34;&#34;&#34;
    with patch(&#34;app.SQLDatabase&#34;) as mock_sql_database:
        mock_sql_database.from_uri.return_value = Mock()
        db = init_database(&#34;user&#34;, &#34;password&#34;, &#34;host&#34;, &#34;port&#34;, &#34;database&#34;)
        if db is None:
            raise AssertionError(&#34;init_database returned None&#34;)
        mock_sql_database.from_uri.assert_called_once()


def test_get_sql_chain(mock_db):
    &#34;&#34;&#34;
    Test the creation of the SQL generation chain.

    This test verifies that the get_sql_chain function returns
    a non-None value when provided with a mock database object.
    &#34;&#34;&#34;
    with patch(&#34;app.ChatGroq&#34;), patch(&#34;app.ChatPromptTemplate&#34;):
        chain = get_sql_chain(mock_db)
        if chain is None:
            raise AssertionError(&#34;get_sql_chain returned None&#34;)


@pytest.mark.asyncio
async def test_get_response(mock_db):
    &#34;&#34;&#34;
    Test the response generation functionality.

    This asynchronous test checks if the get_response function
    returns a non-empty string when provided with a query,
    mock database, and empty chat history.
    &#34;&#34;&#34;
    with patch(&#34;app.get_sql_chain&#34;) as mock_get_sql_chain, patch(&#34;app.ChatGroq&#34;), patch(
        &#34;app.ChatPromptTemplate&#34;
    ):
        mock_get_sql_chain.return_value = Mock()
        mock_db.run.return_value = &#34;Mock SQL Response&#34;
        mock_db.get_table_info.return_value = &#34;Mock Schema&#34;

        response = await get_response(&#34;Test query&#34;, mock_db, [])
        if not isinstance(response, str):
            raise AssertionError(f&#34;Response is not a string: {type(response)}&#34;)
        if not response:
            raise AssertionError(&#34;Response is empty&#34;)


def test_streamlit_components():
    &#34;&#34;&#34;
    Test the Streamlit component interactions.

    This test mocks Streamlit components to ensure they&#39;re being
    called correctly in the application.
    &#34;&#34;&#34;
    with patch(&#34;streamlit.text_input&#34;) as mock_text_input, patch(
        &#34;streamlit.button&#34;
    ) as mock_button, patch(&#34;streamlit.chat_input&#34;) as mock_chat_input:
        mock_text_input.return_value = &#34;test_value&#34;
        mock_button.return_value = True
        mock_chat_input.return_value = &#34;test_query&#34;

        if not mock_text_input.called:
            raise AssertionError(&#34;streamlit.text_input was not called&#34;)
        if not mock_button.called:
            raise AssertionError(&#34;streamlit.button was not called&#34;)
        if not mock_chat_input.called:
            raise AssertionError(&#34;streamlit.chat_input was not called&#34;)


if __name__ == &#34;__main__&#34;:
    pytest.main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="test_app.mock_db"><code class="name flex">
<span>def <span class="ident">mock_db</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Fixture to create a mock database object for testing.</p>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Mock</code></dt>
<dd>A mock object representing the database.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pytest.fixture
def mock_db():
    &#34;&#34;&#34;
    Fixture to create a mock database object for testing.

    Returns:
        Mock: A mock object representing the database.
    &#34;&#34;&#34;
    return Mock()</code></pre>
</details>
</dd>
<dt id="test_app.test_get_response"><code class="name flex">
<span>async def <span class="ident">test_get_response</span></span>(<span>mock_db)</span>
</code></dt>
<dd>
<div class="desc"><p>Test the response generation functionality.</p>
<p>This asynchronous test checks if the get_response function
returns a non-empty string when provided with a query,
mock database, and empty chat history.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@pytest.mark.asyncio
async def test_get_response(mock_db):
    &#34;&#34;&#34;
    Test the response generation functionality.

    This asynchronous test checks if the get_response function
    returns a non-empty string when provided with a query,
    mock database, and empty chat history.
    &#34;&#34;&#34;
    with patch(&#34;app.get_sql_chain&#34;) as mock_get_sql_chain, patch(&#34;app.ChatGroq&#34;), patch(
        &#34;app.ChatPromptTemplate&#34;
    ):
        mock_get_sql_chain.return_value = Mock()
        mock_db.run.return_value = &#34;Mock SQL Response&#34;
        mock_db.get_table_info.return_value = &#34;Mock Schema&#34;

        response = await get_response(&#34;Test query&#34;, mock_db, [])
        if not isinstance(response, str):
            raise AssertionError(f&#34;Response is not a string: {type(response)}&#34;)
        if not response:
            raise AssertionError(&#34;Response is empty&#34;)</code></pre>
</details>
</dd>
<dt id="test_app.test_get_sql_chain"><code class="name flex">
<span>def <span class="ident">test_get_sql_chain</span></span>(<span>mock_db)</span>
</code></dt>
<dd>
<div class="desc"><p>Test the creation of the SQL generation chain.</p>
<p>This test verifies that the get_sql_chain function returns
a non-None value when provided with a mock database object.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_get_sql_chain(mock_db):
    &#34;&#34;&#34;
    Test the creation of the SQL generation chain.

    This test verifies that the get_sql_chain function returns
    a non-None value when provided with a mock database object.
    &#34;&#34;&#34;
    with patch(&#34;app.ChatGroq&#34;), patch(&#34;app.ChatPromptTemplate&#34;):
        chain = get_sql_chain(mock_db)
        if chain is None:
            raise AssertionError(&#34;get_sql_chain returned None&#34;)</code></pre>
</details>
</dd>
<dt id="test_app.test_init_database"><code class="name flex">
<span>def <span class="ident">test_init_database</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Test the initialization of the database connection.</p>
<p>This test ensures that the init_database function correctly
initializes a SQLDatabase object with the given parameters.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_init_database():
    &#34;&#34;&#34;
    Test the initialization of the database connection.

    This test ensures that the init_database function correctly
    initializes a SQLDatabase object with the given parameters.
    &#34;&#34;&#34;
    with patch(&#34;app.SQLDatabase&#34;) as mock_sql_database:
        mock_sql_database.from_uri.return_value = Mock()
        db = init_database(&#34;user&#34;, &#34;password&#34;, &#34;host&#34;, &#34;port&#34;, &#34;database&#34;)
        if db is None:
            raise AssertionError(&#34;init_database returned None&#34;)
        mock_sql_database.from_uri.assert_called_once()</code></pre>
</details>
</dd>
<dt id="test_app.test_streamlit_components"><code class="name flex">
<span>def <span class="ident">test_streamlit_components</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>Test the Streamlit component interactions.</p>
<p>This test mocks Streamlit components to ensure they're being
called correctly in the application.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_streamlit_components():
    &#34;&#34;&#34;
    Test the Streamlit component interactions.

    This test mocks Streamlit components to ensure they&#39;re being
    called correctly in the application.
    &#34;&#34;&#34;
    with patch(&#34;streamlit.text_input&#34;) as mock_text_input, patch(
        &#34;streamlit.button&#34;
    ) as mock_button, patch(&#34;streamlit.chat_input&#34;) as mock_chat_input:
        mock_text_input.return_value = &#34;test_value&#34;
        mock_button.return_value = True
        mock_chat_input.return_value = &#34;test_query&#34;

        if not mock_text_input.called:
            raise AssertionError(&#34;streamlit.text_input was not called&#34;)
        if not mock_button.called:
            raise AssertionError(&#34;streamlit.button was not called&#34;)
        if not mock_chat_input.called:
            raise AssertionError(&#34;streamlit.chat_input was not called&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="test_app.mock_db" href="#test_app.mock_db">mock_db</a></code></li>
<li><code><a title="test_app.test_get_response" href="#test_app.test_get_response">test_get_response</a></code></li>
<li><code><a title="test_app.test_get_sql_chain" href="#test_app.test_get_sql_chain">test_get_sql_chain</a></code></li>
<li><code><a title="test_app.test_init_database" href="#test_app.test_init_database">test_init_database</a></code></li>
<li><code><a title="test_app.test_streamlit_components" href="#test_app.test_streamlit_components">test_streamlit_components</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>